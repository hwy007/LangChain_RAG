openapi: 3.0.3
info:
  title: RAGæœ¬åœ°çŸ¥è¯†åº“é—®ç­”å¼•æ“ - åç«¯API
  description: |
    åŸºäºLangGraphæ„å»ºçš„RAGç³»ç»Ÿåç«¯æœåŠ¡ï¼Œæ”¯æŒPDFã€Markdownã€Textæ–‡ä»¶çš„æ–‡æœ¬æå–ã€
    åˆ‡åˆ†å’Œæœ¬åœ°å‘é‡æ•°æ®åº“åˆ›å»ºï¼Œæä¾›æ™ºèƒ½é—®ç­”å’Œè¯­ä¹‰æ£€ç´¢åŠŸèƒ½ã€‚
    
    ## æ ¸å¿ƒåŠŸèƒ½
    - ğŸ¤– æ™ºèƒ½å¯¹è¯é—®ç­” (åŸºäºRAGæ£€ç´¢å¢å¼ºç”Ÿæˆ)
    - ğŸ“š å¤šæ ¼å¼æ–‡æ¡£å¤„ç† (PDFã€Markdownã€Text)
    - ğŸ” å‘é‡åŒ–è¯­ä¹‰æ£€ç´¢
    - ğŸ’¾ æœ¬åœ°å‘é‡æ•°æ®åº“ç®¡ç†
    - âš™ï¸ å¯é…ç½®çš„æ–‡æ¡£åˆ‡åˆ†å‚æ•°
    
    ## æ•°æ®å®‰å…¨
    - æœ¬ç³»ç»Ÿä»…å¤„ç†ç¬¦åˆç‰¹å®šæ ¼å¼è¦æ±‚çš„æ•°æ®é›†
    - æ‰€æœ‰ä¸Šä¼ æ–‡ä»¶å°†ç»è¿‡ä¸¥æ ¼çš„æ ¼å¼éªŒè¯å’Œå†…å®¹æ£€æŸ¥
    - ä¸åˆè§„æ•°æ®å°†è¢«æ‹’ç»å¤„ç†å¹¶è¿”å›è¯¦ç»†é”™è¯¯ä¿¡æ¯
    
  version: 1.0.0
  contact:
    name: ä¹å¤©Hector
    email: support@example.com
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT

servers:
  - url: http://localhost:8000/api
    description: æœ¬åœ°å¼€å‘æœåŠ¡å™¨
  - url: https://api.rag-system.com/api
    description: ç”Ÿäº§ç¯å¢ƒæœåŠ¡å™¨

tags:
  - name: chat
    description: æ™ºèƒ½å¯¹è¯é—®ç­”æ¥å£
  - name: upload
    description: æ–‡ä»¶ä¸Šä¼ å’Œæ•°æ®åº“åˆ›å»ºæ¥å£
  - name: retrieve
    description: è¯­ä¹‰æ£€ç´¢æµ‹è¯•æ¥å£
  - name: database
    description: å‘é‡æ•°æ®åº“ç®¡ç†æ¥å£
  - name: system
    description: ç³»ç»ŸçŠ¶æ€å’Œå¥åº·æ£€æŸ¥æ¥å£

paths:
  /chat:
    post:
      tags:
        - chat
      summary: å‘é€èŠå¤©æ¶ˆæ¯
      description: |
        å‘AIåŠ©æ‰‹å‘é€ç”¨æˆ·é—®é¢˜ï¼ŒåŸºäºæŒ‡å®šçš„å‘é‡æ•°æ®åº“è¿›è¡ŒRAGé—®ç­”ã€‚
        ç³»ç»Ÿå°†æ£€ç´¢ç›¸å…³æ–‡æ¡£ç‰‡æ®µï¼Œç»“åˆå¤§è¯­è¨€æ¨¡å‹ç”Ÿæˆå‡†ç¡®å›ç­”ã€‚
      operationId: sendChatMessage
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ChatRequest'
            examples:
              basic_question:
                summary: åŸºç¡€é—®é¢˜ç¤ºä¾‹
                value:
                  message: "ä»€ä¹ˆæ˜¯LangGraphï¼Ÿ"
                  database_name: "my_knowledge_base"
              complex_question:
                summary: å¤æ‚é—®é¢˜ç¤ºä¾‹
                value:
                  message: "è¯·è¯¦ç»†è§£é‡ŠRAGç³»ç»Ÿçš„å·¥ä½œåŸç†å’Œä¼˜åŠ¿"
                  database_name: "technical_docs"
      responses:
        '200':
          description: æˆåŠŸè¿”å›AIå›ç­”
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ChatResponse'
              examples:
                successful_response:
                  summary: æˆåŠŸå“åº”ç¤ºä¾‹
                  value:
                    response: "LangGraph æ˜¯ä¸€ä¸ªåŸºäºå›¾ç»“æ„çš„AIå·¥ä½œæµç¼–æ’æ¡†æ¶ï¼Œå®ƒå…è®¸å¼€å‘è€…æ„å»ºå¤æ‚çš„å¤šæ­¥éª¤AIåº”ç”¨ã€‚"
                    document_fragments:
                      - id: "frag_001"
                        content: "LangGraph æ˜¯ä¸€ä¸ªåŸºäºå›¾ç»“æ„çš„AIå·¥ä½œæµç¼–æ’æ¡†æ¶..."
                        relevance: 0.85
                        index: 1
                        source_file: "langgraph_intro.md"
                        chunk_id: "chunk_001"
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          description: æŒ‡å®šçš„æ•°æ®åº“ä¸å­˜åœ¨
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: "DATABASE_NOT_FOUND"
                message: "æ•°æ®åº“ 'my_knowledge_base' ä¸å­˜åœ¨"
                details: "è¯·å…ˆä¸Šä¼ æ–‡æ¡£åˆ›å»ºæ•°æ®åº“"
        '500':
          $ref: '#/components/responses/InternalServerError'

  /upload:
    post:
      tags:
        - upload
      summary: ä¸Šä¼ æ–‡ä»¶å¹¶åˆ›å»ºå‘é‡æ•°æ®åº“
      description: |
        ä¸Šä¼ æ–‡æ¡£æ–‡ä»¶å¹¶æ ¹æ®é…ç½®å‚æ•°åˆ›å»ºå‘é‡æ•°æ®åº“ã€‚æ”¯æŒä»¥ä¸‹æ ¼å¼ï¼š
        - PDFæ–‡ä»¶ (.pdf)
        - Markdownæ–‡ä»¶ (.md)
        - çº¯æ–‡æœ¬æ–‡ä»¶ (.txt)
        
        ### æ•°æ®éªŒè¯è§„åˆ™
        - æ–‡ä»¶å¤§å°é™åˆ¶: å•æ–‡ä»¶æœ€å¤§50MBï¼Œæ€»è®¡æœ€å¤§200MB
        - æ–‡ä»¶æ•°é‡é™åˆ¶: æœ€å¤š50ä¸ªæ–‡ä»¶
        - å†…å®¹æ£€æŸ¥: ä»…å¤„ç†ç¬¦åˆé¢„å®šä¹‰æ¨¡å¼çš„æ–‡æ¡£ç»“æ„
        - ç¼–ç è¦æ±‚: æ–‡æœ¬æ–‡ä»¶å¿…é¡»ä¸ºUTF-8ç¼–ç 
      operationId: uploadFiles
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required:
                - files
                - config
              properties:
                files:
                  type: array
                  items:
                    type: string
                    format: binary
                  description: è¦ä¸Šä¼ çš„æ–‡æ¡£æ–‡ä»¶æ•°ç»„
                  maxItems: 50
                config:
                  $ref: '#/components/schemas/DatabaseConfig'
            examples:
              basic_upload:
                summary: åŸºç¡€ä¸Šä¼ ç¤ºä¾‹
                value:
                  config:
                    name: "my_knowledge_base"
                    max_chunk_size: 2048
                    max_overlap: 100
                    top_k: 3
      responses:
        '201':
          description: æˆåŠŸåˆ›å»ºå‘é‡æ•°æ®åº“
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UploadResponse'
              example:
                success: true
                database:
                  name: "my_knowledge_base"
                  status: "created"
                  document_count: 5
                  chunk_count: 125
                  created_at: "2024-01-15T10:30:00Z"
                  config:
                    max_chunk_size: 2048
                    max_overlap: 100
                    top_k: 3
                processing_summary:
                  total_files: 5
                  processed_files: 5
                  failed_files: 0
                  total_chunks: 125
                  processing_time_seconds: 45.2
        '400':
          description: è¯·æ±‚å‚æ•°é”™è¯¯æˆ–æ–‡ä»¶æ ¼å¼ä¸æ”¯æŒ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                invalid_format:
                  summary: ä¸æ”¯æŒçš„æ–‡ä»¶æ ¼å¼
                  value:
                    error: "INVALID_FILE_FORMAT"
                    message: "ä¸æ”¯æŒçš„æ–‡ä»¶æ ¼å¼"
                    details: "ä»…æ”¯æŒ PDFã€Markdown(.md) å’Œ Text(.txt) æ ¼å¼"
                data_validation_failed:
                  summary: æ•°æ®éªŒè¯å¤±è´¥
                  value:
                    error: "DATA_VALIDATION_FAILED"
                    message: "ä¸Šä¼ çš„æ•°æ®ä¸ç¬¦åˆå¤„ç†è¦æ±‚"
                    details: "æ–‡ä»¶ 'document.pdf' åŒ…å«ä¸æ”¯æŒçš„æ•°æ®æ ¼å¼æˆ–ç»“æ„"
        '409':
          description: æ•°æ®åº“åç§°å·²å­˜åœ¨
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: "DATABASE_EXISTS"
                message: "æ•°æ®åº“åç§°å·²å­˜åœ¨"
                details: "è¯·é€‰æ‹©å…¶ä»–åç§°æˆ–åˆ é™¤ç°æœ‰æ•°æ®åº“"
        '413':
          description: æ–‡ä»¶å¤§å°è¶…å‡ºé™åˆ¶
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: "FILE_TOO_LARGE"
                message: "æ–‡ä»¶å¤§å°è¶…å‡ºé™åˆ¶"
                details: "å•æ–‡ä»¶æœ€å¤§50MBï¼Œæ€»è®¡æœ€å¤§200MB"
        '500':
          $ref: '#/components/responses/InternalServerError'

  /retrieve:
    post:
      tags:
        - retrieve
      summary: è¯­ä¹‰æ£€ç´¢æµ‹è¯•
      description: |
        åœ¨æŒ‡å®šçš„å‘é‡æ•°æ®åº“ä¸­æ‰§è¡Œè¯­ä¹‰æ£€ç´¢ï¼Œè¿”å›ä¸æŸ¥è¯¢æœ€ç›¸å…³çš„æ–‡æ¡£ç‰‡æ®µã€‚
        ç”¨äºæµ‹è¯•æ•°æ®åº“çš„æ£€ç´¢æ•ˆæœå’Œè°ƒè¯•æ£€ç´¢å‚æ•°ã€‚
      operationId: retrieveDocuments
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RetrieveRequest'
            examples:
              basic_search:
                summary: åŸºç¡€æ£€ç´¢ç¤ºä¾‹
                value:
                  query: "LangGraphçš„å·¥ä½œåŸç†"
                  database_name: "my_knowledge_base"
                  top_k: 3
              advanced_search:
                summary: é«˜çº§æ£€ç´¢ç¤ºä¾‹
                value:
                  query: "å¦‚ä½•å®ç°RAGç³»ç»Ÿçš„æ–‡æ¡£åˆ‡åˆ†"
                  database_name: "technical_docs"
                  top_k: 5
                  min_relevance: 0.6
      responses:
        '200':
          description: æˆåŠŸè¿”å›æ£€ç´¢ç»“æœ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RetrieveResponse'
              example:
                fragments:
                  - id: "frag_001"
                    content: "LangGraph æ˜¯ä¸€ä¸ªåŸºäºå›¾ç»“æ„çš„AIå·¥ä½œæµç¼–æ’æ¡†æ¶..."
                    relevance: 0.85
                    index: 1
                    source_file: "langgraph_guide.md"
                    chunk_id: "chunk_001"
                  - id: "frag_002"
                    content: "ä¸ä¼ ç»Ÿçš„é“¾å¼è°ƒç”¨ä¸åŒï¼ŒLangGraphé‡‡ç”¨æœ‰å‘æ— ç¯å›¾..."
                    relevance: 0.78
                    index: 2
                    source_file: "langgraph_guide.md"
                    chunk_id: "chunk_002"
                query_info:
                  original_query: "LangGraphçš„å·¥ä½œåŸç†"
                  processed_query: "langgraph å·¥ä½œ åŸç†"
                  search_time_ms: 45
                  total_chunks_searched: 125
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          description: æŒ‡å®šçš„æ•°æ®åº“ä¸å­˜åœ¨
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: "DATABASE_NOT_FOUND"
                message: "æ•°æ®åº“ä¸å­˜åœ¨"
                details: "æ•°æ®åº“ 'my_knowledge_base' æœªæ‰¾åˆ°"
        '500':
          $ref: '#/components/responses/InternalServerError'

  /database/{name}:
    delete:
      tags:
        - database
      summary: åˆ é™¤å‘é‡æ•°æ®åº“
      description: |
        å®Œå…¨åˆ é™¤æŒ‡å®šçš„å‘é‡æ•°æ®åº“åŠå…¶æ‰€æœ‰æ•°æ®ï¼ŒåŒ…æ‹¬ï¼š
        - å‘é‡ç´¢å¼•æ–‡ä»¶
        - åŸå§‹æ–‡æ¡£ç‰‡æ®µ
        - å…ƒæ•°æ®ä¿¡æ¯
        
        âš ï¸ æ­¤æ“ä½œä¸å¯é€†ï¼Œè¯·è°¨æ…ä½¿ç”¨ã€‚
      operationId: deleteDatabase
      parameters:
        - name: name
          in: path
          required: true
          description: è¦åˆ é™¤çš„æ•°æ®åº“åç§°
          schema:
            type: string
            example: "my_knowledge_base"
      responses:
        '200':
          description: æˆåŠŸåˆ é™¤æ•°æ®åº“
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DeleteResponse'
              example:
                success: true
                message: "æ•°æ®åº“å·²æˆåŠŸåˆ é™¤"
                deleted_database:
                  name: "my_knowledge_base"
                  document_count: 5
                  chunk_count: 125
                  deleted_at: "2024-01-15T11:45:00Z"
        '404':
          description: æ•°æ®åº“ä¸å­˜åœ¨
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: "DATABASE_NOT_FOUND"
                message: "æ•°æ®åº“ä¸å­˜åœ¨"
                details: "æ•°æ®åº“ 'my_knowledge_base' æœªæ‰¾åˆ°"
        '500':
          $ref: '#/components/responses/InternalServerError'

    get:
      tags:
        - database
      summary: è·å–æ•°æ®åº“çŠ¶æ€ä¿¡æ¯
      description: |
        è·å–æŒ‡å®šå‘é‡æ•°æ®åº“çš„è¯¦ç»†çŠ¶æ€ä¿¡æ¯ï¼ŒåŒ…æ‹¬æ–‡æ¡£æ•°é‡ã€
        å‘é‡ç»´åº¦ã€åˆ›å»ºæ—¶é—´ç­‰å…ƒæ•°æ®ã€‚
      operationId: getDatabaseStatus
      parameters:
        - name: name
          in: path
          required: true
          description: æ•°æ®åº“åç§°
          schema:
            type: string
            example: "my_knowledge_base"
      responses:
        '200':
          description: æˆåŠŸè¿”å›æ•°æ®åº“çŠ¶æ€
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DatabaseStatus'
              example:
                name: "my_knowledge_base"
                is_created: true
                document_count: 5
                chunk_count: 125
                vector_dimension: 1536
                created_at: "2024-01-15T10:30:00Z"
                last_updated: "2024-01-15T10:35:00Z"
                config:
                  max_chunk_size: 2048
                  max_overlap: 100
                  top_k: 3
                statistics:
                  avg_chunk_size: 1850
                  total_size_mb: 12.5
                  supported_formats: ["pdf", "md", "txt"]
        '404':
          description: æ•°æ®åº“ä¸å­˜åœ¨
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: "DATABASE_NOT_FOUND"
                message: "æ•°æ®åº“ä¸å­˜åœ¨"
        '500':
          $ref: '#/components/responses/InternalServerError'

  /database:
    get:
      tags:
        - database
      summary: è·å–æ‰€æœ‰æ•°æ®åº“åˆ—è¡¨
      description: è·å–å½“å‰ç³»ç»Ÿä¸­æ‰€æœ‰å‘é‡æ•°æ®åº“çš„åŸºæœ¬ä¿¡æ¯åˆ—è¡¨
      operationId: listDatabases
      responses:
        '200':
          description: æˆåŠŸè¿”å›æ•°æ®åº“åˆ—è¡¨
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DatabaseListResponse'
              example:
                databases:
                  - name: "my_knowledge_base"
                    document_count: 5
                    chunk_count: 125
                    created_at: "2024-01-15T10:30:00Z"
                    status: "active"
                  - name: "technical_docs"
                    document_count: 12
                    chunk_count: 340
                    created_at: "2024-01-14T15:20:00Z"
                    status: "active"
                total_count: 2
        '500':
          $ref: '#/components/responses/InternalServerError'

  /health:
    get:
      tags:
        - system
      summary: ç³»ç»Ÿå¥åº·æ£€æŸ¥
      description: |
        è·å–ç³»ç»Ÿè¿è¡ŒçŠ¶æ€å’Œå¥åº·ä¿¡æ¯ï¼ŒåŒ…æ‹¬ï¼š
        - æœåŠ¡è¿è¡ŒçŠ¶æ€
        - æ•°æ®åº“è¿æ¥çŠ¶æ€
        - AIæ¨¡å‹åŠ è½½çŠ¶æ€
        - ç³»ç»Ÿèµ„æºä½¿ç”¨æƒ…å†µ
      operationId: healthCheck
      responses:
        '200':
          description: ç³»ç»Ÿè¿è¡Œæ­£å¸¸
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthResponse'
              example:
                status: "healthy"
                timestamp: "2024-01-15T12:00:00Z"
                version: "1.0.0"
                uptime_seconds: 86400
                services:
                  llm_service: "healthy"
                  vector_db: "healthy"
                  file_processor: "healthy"
                system_info:
                  memory_usage_mb: 2048
                  cpu_usage_percent: 25.5
                  disk_usage_percent: 15.2
                  active_databases: 2
        '503':
          description: ç³»ç»ŸæœåŠ¡ä¸å¯ç”¨
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthResponse'
              example:
                status: "unhealthy"
                timestamp: "2024-01-15T12:00:00Z"
                services:
                  llm_service: "error"
                  vector_db: "healthy"
                  file_processor: "healthy"
                errors:
                  - "LLMæœåŠ¡è¿æ¥è¶…æ—¶"

  /system/supported-formats:
    get:
      tags:
        - system
      summary: è·å–æ”¯æŒçš„æ–‡ä»¶æ ¼å¼
      description: |
        è·å–ç³»ç»Ÿæ”¯æŒå¤„ç†çš„æ–‡ä»¶æ ¼å¼åˆ—è¡¨å’Œç›¸å…³é™åˆ¶ä¿¡æ¯ã€‚
        ç”¨äºå‰ç«¯éªŒè¯å’Œç”¨æˆ·æç¤ºã€‚
      operationId: getSupportedFormats
      responses:
        '200':
          description: æˆåŠŸè¿”å›æ”¯æŒçš„æ ¼å¼ä¿¡æ¯
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SupportedFormatsResponse'
              example:
                supported_formats:
                  - extension: ".pdf"
                    mime_type: "application/pdf"
                    max_size_mb: 50
                    description: "PDFæ–‡æ¡£"
                  - extension: ".md"
                    mime_type: "text/markdown"
                    max_size_mb: 10
                    description: "Markdownæ–‡æ¡£"
                  - extension: ".txt"
                    mime_type: "text/plain"
                    max_size_mb: 10
                    description: "çº¯æ–‡æœ¬æ–‡æ¡£"
                limitations:
                  max_files_per_upload: 50
                  max_total_size_mb: 200
                  max_file_size_mb: 50
                  required_encoding: "UTF-8"

components:
  schemas:
    # è¯·æ±‚ä½“æ¨¡å¼
    ChatRequest:
      type: object
      required:
        - message
        - database_name
      properties:
        message:
          type: string
          description: ç”¨æˆ·è¾“å…¥çš„é—®é¢˜
          minLength: 1
          maxLength: 2000
          example: "ä»€ä¹ˆæ˜¯LangGraphï¼Ÿ"
        database_name:
          type: string
          description: è¦æŸ¥è¯¢çš„æ•°æ®åº“åç§°
          pattern: '^[a-zA-Z0-9_-]+$'
          minLength: 1
          maxLength: 50
          example: "my_knowledge_base"

    DatabaseConfig:
      type: object
      required:
        - name
      properties:
        name:
          type: string
          description: æ•°æ®åº“åç§°
          pattern: '^[a-zA-Z0-9_-]+$'
          minLength: 1
          maxLength: 50
          example: "my_knowledge_base"
        max_chunk_size:
          type: integer
          description: æ–‡æ¡£åˆ‡åˆ†æœ€å¤§é•¿åº¦ï¼ˆtokensï¼‰
          minimum: 100
          maximum: 8192
          default: 2048
          example: 2048
        max_overlap:
          type: integer
          description: åˆ‡åˆ†é‡å æœ€å¤§é•¿åº¦ï¼ˆtokensï¼‰
          minimum: 0
          maximum: 500
          default: 100
          example: 100
        top_k:
          type: integer
          description: æ£€ç´¢è¿”å›çš„æœ€å¤§æ–‡æ¡£ç‰‡æ®µæ•°é‡
          minimum: 1
          maximum: 20
          default: 3
          example: 3

    RetrieveRequest:
      type: object
      required:
        - query
        - database_name
      properties:
        query:
          type: string
          description: æ£€ç´¢æŸ¥è¯¢æ–‡æœ¬
          minLength: 1
          maxLength: 1000
          example: "LangGraphçš„å·¥ä½œåŸç†"
        database_name:
          type: string
          description: è¦æ£€ç´¢çš„æ•°æ®åº“åç§°
          pattern: '^[a-zA-Z0-9_-]+$'
          example: "my_knowledge_base"
        top_k:
          type: integer
          description: è¿”å›ç»“æœæ•°é‡
          minimum: 1
          maximum: 20
          default: 3
          example: 3
        min_relevance:
          type: number
          description: æœ€å°ç›¸å…³æ€§é˜ˆå€¼
          minimum: 0.0
          maximum: 1.0
          default: 0.0
          example: 0.6

    # å“åº”ä½“æ¨¡å¼
    ChatResponse:
      type: object
      required:
        - response
        - document_fragments
      properties:
        response:
          type: string
          description: AIç”Ÿæˆçš„å›ç­”
          example: "LangGraph æ˜¯ä¸€ä¸ªåŸºäºå›¾ç»“æ„çš„AIå·¥ä½œæµç¼–æ’æ¡†æ¶..."
        document_fragments:
          type: array
          items:
            $ref: '#/components/schemas/DocumentFragment'
          description: å‚è€ƒçš„æ–‡æ¡£ç‰‡æ®µåˆ—è¡¨
          maxItems: 20

    DocumentFragment:
      type: object
      required:
        - id
        - content
        - relevance
        - index
      properties:
        id:
          type: string
          description: æ–‡æ¡£ç‰‡æ®µå”¯ä¸€æ ‡è¯†
          example: "frag_001"
        content:
          type: string
          description: æ–‡æ¡£ç‰‡æ®µå†…å®¹
          example: "LangGraph æ˜¯ä¸€ä¸ªåŸºäºå›¾ç»“æ„çš„AIå·¥ä½œæµç¼–æ’æ¡†æ¶..."
        relevance:
          type: number
          description: ç›¸å…³æ€§è¯„åˆ†ï¼ˆ0-1ï¼‰
          minimum: 0.0
          maximum: 1.0
          example: 0.85
        index:
          type: integer
          description: ç‰‡æ®µåœ¨åŸæ–‡æ¡£ä¸­çš„ç´¢å¼•
          minimum: 1
          example: 1
        source_file:
          type: string
          description: æºæ–‡ä»¶åç§°
          example: "langgraph_guide.md"
        chunk_id:
          type: string
          description: æ–‡æ¡£å—ID
          example: "chunk_001"

    UploadResponse:
      type: object
      required:
        - success
        - database
        - processing_summary
      properties:
        success:
          type: boolean
          description: ä¸Šä¼ æ˜¯å¦æˆåŠŸ
          example: true
        database:
          $ref: '#/components/schemas/DatabaseInfo'
        processing_summary:
          $ref: '#/components/schemas/ProcessingSummary'

    DatabaseInfo:
      type: object
      required:
        - name
        - status
        - document_count
        - chunk_count
        - created_at
        - config
      properties:
        name:
          type: string
          description: æ•°æ®åº“åç§°
          example: "my_knowledge_base"
        status:
          type: string
          enum: [created, processing, error]
          description: æ•°æ®åº“çŠ¶æ€
          example: "created"
        document_count:
          type: integer
          description: æ–‡æ¡£æ•°é‡
          minimum: 0
          example: 5
        chunk_count:
          type: integer
          description: æ–‡æ¡£ç‰‡æ®µæ•°é‡
          minimum: 0
          example: 125
        created_at:
          type: string
          format: date-time
          description: åˆ›å»ºæ—¶é—´
          example: "2024-01-15T10:30:00Z"
        config:
          $ref: '#/components/schemas/DatabaseConfig'

    ProcessingSummary:
      type: object
      required:
        - total_files
        - processed_files
        - failed_files
        - total_chunks
        - processing_time_seconds
      properties:
        total_files:
          type: integer
          description: æ€»æ–‡ä»¶æ•°
          example: 5
        processed_files:
          type: integer
          description: æˆåŠŸå¤„ç†çš„æ–‡ä»¶æ•°
          example: 5
        failed_files:
          type: integer
          description: å¤„ç†å¤±è´¥çš„æ–‡ä»¶æ•°
          example: 0
        failed_file_details:
          type: array
          items:
            type: object
            properties:
              filename:
                type: string
              error:
                type: string
              reason:
                type: string
          description: å¤±è´¥æ–‡ä»¶è¯¦æƒ…
        total_chunks:
          type: integer
          description: ç”Ÿæˆçš„æ€»æ–‡æ¡£ç‰‡æ®µæ•°
          example: 125
        processing_time_seconds:
          type: number
          description: å¤„ç†è€—æ—¶ï¼ˆç§’ï¼‰
          example: 45.2

    RetrieveResponse:
      type: object
      required:
        - fragments
        - query_info
      properties:
        fragments:
          type: array
          items:
            $ref: '#/components/schemas/DocumentFragment'
          description: æ£€ç´¢åˆ°çš„æ–‡æ¡£ç‰‡æ®µ
        query_info:
          $ref: '#/components/schemas/QueryInfo'

    QueryInfo:
      type: object
      required:
        - original_query
        - processed_query
        - search_time_ms
        - total_chunks_searched
      properties:
        original_query:
          type: string
          description: åŸå§‹æŸ¥è¯¢
          example: "LangGraphçš„å·¥ä½œåŸç†"
        processed_query:
          type: string
          description: å¤„ç†åçš„æŸ¥è¯¢
          example: "langgraph å·¥ä½œ åŸç†"
        search_time_ms:
          type: integer
          description: æ£€ç´¢è€—æ—¶ï¼ˆæ¯«ç§’ï¼‰
          example: 45
        total_chunks_searched:
          type: integer
          description: æœç´¢çš„æ€»æ–‡æ¡£ç‰‡æ®µæ•°
          example: 125

    DatabaseStatus:
      type: object
      required:
        - name
        - is_created
        - document_count
        - chunk_count
        - created_at
        - config
      properties:
        name:
          type: string
          description: æ•°æ®åº“åç§°
          example: "my_knowledge_base"
        is_created:
          type: boolean
          description: æ•°æ®åº“æ˜¯å¦å·²åˆ›å»º
          example: true
        document_count:
          type: integer
          description: æ–‡æ¡£æ•°é‡
          example: 5
        chunk_count:
          type: integer
          description: æ–‡æ¡£ç‰‡æ®µæ•°é‡
          example: 125
        vector_dimension:
          type: integer
          description: å‘é‡ç»´åº¦
          example: 1536
        created_at:
          type: string
          format: date-time
          description: åˆ›å»ºæ—¶é—´
          example: "2024-01-15T10:30:00Z"
        last_updated:
          type: string
          format: date-time
          description: æœ€åæ›´æ–°æ—¶é—´
          example: "2024-01-15T10:35:00Z"
        config:
          $ref: '#/components/schemas/DatabaseConfig'
        statistics:
          $ref: '#/components/schemas/DatabaseStatistics'

    DatabaseStatistics:
      type: object
      properties:
        avg_chunk_size:
          type: integer
          description: å¹³å‡æ–‡æ¡£ç‰‡æ®µå¤§å°
          example: 1850
        total_size_mb:
          type: number
          description: æ•°æ®åº“æ€»å¤§å°ï¼ˆMBï¼‰
          example: 12.5
        supported_formats:
          type: array
          items:
            type: string
          description: æ”¯æŒçš„æ–‡ä»¶æ ¼å¼
          example: ["pdf", "md", "txt"]

    DatabaseListResponse:
      type: object
      required:
        - databases
        - total_count
      properties:
        databases:
          type: array
          items:
            $ref: '#/components/schemas/DatabaseSummary'
        total_count:
          type: integer
          description: æ•°æ®åº“æ€»æ•°
          example: 2

    DatabaseSummary:
      type: object
      required:
        - name
        - document_count
        - chunk_count
        - created_at
        - status
      properties:
        name:
          type: string
          example: "my_knowledge_base"
        document_count:
          type: integer
          example: 5
        chunk_count:
          type: integer
          example: 125
        created_at:
          type: string
          format: date-time
          example: "2024-01-15T10:30:00Z"
        status:
          type: string
          enum: [active, processing, error, inactive]
          example: "active"

    DeleteResponse:
      type: object
      required:
        - success
        - message
        - deleted_database
      properties:
        success:
          type: boolean
          example: true
        message:
          type: string
          example: "æ•°æ®åº“å·²æˆåŠŸåˆ é™¤"
        deleted_database:
          type: object
          properties:
            name:
              type: string
              example: "my_knowledge_base"
            document_count:
              type: integer
              example: 5
            chunk_count:
              type: integer
              example: 125
            deleted_at:
              type: string
              format: date-time
              example: "2024-01-15T11:45:00Z"

    HealthResponse:
      type: object
      required:
        - status
        - timestamp
        - version
        - services
      properties:
        status:
          type: string
          enum: [healthy, unhealthy, degraded]
          description: ç³»ç»Ÿæ•´ä½“çŠ¶æ€
          example: "healthy"
        timestamp:
          type: string
          format: date-time
          description: æ£€æŸ¥æ—¶é—´
          example: "2024-01-15T12:00:00Z"
        version:
          type: string
          description: ç³»ç»Ÿç‰ˆæœ¬
          example: "1.0.0"
        uptime_seconds:
          type: integer
          description: ç³»ç»Ÿè¿è¡Œæ—¶é—´ï¼ˆç§’ï¼‰
          example: 86400
        services:
          type: object
          properties:
            llm_service:
              type: string
              enum: [healthy, unhealthy, error]
              example: "healthy"
            vector_db:
              type: string
              enum: [healthy, unhealthy, error]
              example: "healthy"
            file_processor:
              type: string
              enum: [healthy, unhealthy, error]
              example: "healthy"
        system_info:
          type: object
          properties:
            memory_usage_mb:
              type: number
              example: 2048
            cpu_usage_percent:
              type: number
              example: 25.5
            disk_usage_percent:
              type: number
              example: 15.2
            active_databases:
              type: integer
              example: 2
        errors:
          type: array
          items:
            type: string
          description: é”™è¯¯ä¿¡æ¯åˆ—è¡¨
          example: ["LLMæœåŠ¡è¿æ¥è¶…æ—¶"]

    SupportedFormatsResponse:
      type: object
      required:
        - supported_formats
        - limitations
      properties:
        supported_formats:
          type: array
          items:
            type: object
            properties:
              extension:
                type: string
                example: ".pdf"
              mime_type:
                type: string
                example: "application/pdf"
              max_size_mb:
                type: number
                example: 50
              description:
                type: string
                example: "PDFæ–‡æ¡£"
        limitations:
          type: object
          properties:
            max_files_per_upload:
              type: integer
              example: 50
            max_total_size_mb:
              type: number
              example: 200
            max_file_size_mb:
              type: number
              example: 50
            required_encoding:
              type: string
              example: "UTF-8"

    ErrorResponse:
      type: object
      required:
        - error
        - message
      properties:
        error:
          type: string
          description: é”™è¯¯ä»£ç 
          example: "VALIDATION_ERROR"
        message:
          type: string
          description: é”™è¯¯æè¿°
          example: "è¯·æ±‚å‚æ•°éªŒè¯å¤±è´¥"
        details:
          type: string
          description: è¯¦ç»†é”™è¯¯ä¿¡æ¯
          example: "å­—æ®µ 'message' ä¸èƒ½ä¸ºç©º"
        timestamp:
          type: string
          format: date-time
          description: é”™è¯¯å‘ç”Ÿæ—¶é—´
          example: "2024-01-15T12:00:00Z"
        request_id:
          type: string
          description: è¯·æ±‚IDï¼Œç”¨äºé—®é¢˜è¿½è¸ª
          example: "req_123456789"

  responses:
    BadRequest:
      description: è¯·æ±‚å‚æ•°é”™è¯¯
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            error: "VALIDATION_ERROR"
            message: "è¯·æ±‚å‚æ•°éªŒè¯å¤±è´¥"
            details: "å­—æ®µéªŒè¯é”™è¯¯"

    InternalServerError:
      description: æœåŠ¡å™¨å†…éƒ¨é”™è¯¯
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            error: "INTERNAL_SERVER_ERROR"
            message: "æœåŠ¡å™¨å†…éƒ¨é”™è¯¯"
            details: "è¯·ç¨åé‡è¯•æˆ–è”ç³»æŠ€æœ¯æ”¯æŒ"

  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: |
        JWT Bearer Tokenè®¤è¯ï¼ˆå¦‚éœ€è¦ï¼‰
        æ ¼å¼: Authorization: Bearer <token>

# å…¨å±€å®‰å…¨é…ç½®ï¼ˆå¯é€‰ï¼‰
# security:
#   - BearerAuth: []

# å¤–éƒ¨æ–‡æ¡£é“¾æ¥
externalDocs:
  description: æŸ¥çœ‹å®Œæ•´çš„å‰ç«¯äº§å“éœ€æ±‚æ–‡æ¡£
  url: /å‰ç«¯äº§å“éœ€æ±‚æ–‡æ¡£-PRD.md